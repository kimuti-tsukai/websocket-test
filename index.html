<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>WS Client (for GitHub Pages)</title>
        <style>
            body {
                font-family: system-ui, sans-serif;
                max-width: 720px;
                margin: 2rem;
            }
            #log {
                white-space: pre-wrap;
                border: 1px solid #ddd;
                padding: 8px;
                min-height: 160px;
                background: #fafafa;
            }
            input[type="text"] {
                width: 60%;
            }
        </style>
    </head>
    <body>
        <h1>WebSocket Client</h1>
        <p>
            接続先（wss URL）:
            <input
                id="url"
                type="text"
                value=""
                placeholder="例: wss://abcd1234.ngrok.io"
            />
        </p>
        <p>
            <button id="connect">Connect</button>
            <button id="disconnect" disabled>Disconnect</button>
        </p>
        <p>
            <input id="msg" placeholder="Send message..." type="text" />
            <button id="send" disabled>Send</button>
        </p>

        <h3>ログ</h3>
        <div id="log"></div>

        <script>
            const $ = (id) => document.getElementById(id);
            const log = (s) => {
                $("log").textContent += s + "\n";
                $("log").scrollTop = $("log").scrollHeight;
            };

            let ws = null;

            $("connect").onclick = () => {
                const url = $("url").value.trim();
                if (!url) {
                    alert(
                        "wss URL を入力してください（例: wss://abcd1234.ngrok.io）",
                    );
                    return;
                }
                try {
                    ws = new WebSocket(url);
                } catch (e) {
                    log("WebSocket error: " + e);
                    return;
                }
                log("Connecting to " + url + " ...");
                $("connect").disabled = true;

                ws.onopen = () => {
                    log("OPEN");
                    $("disconnect").disabled = false;
                    $("send").disabled = false;
                };
                ws.onmessage = (ev) => {
                    log("RECV: " + ev.data);
                };
                ws.onclose = (ev) => {
                    log("CLOSE code=" + ev.code + " reason=" + ev.reason);
                    $("connect").disabled = false;
                    $("disconnect").disabled = true;
                    $("send").disabled = true;
                };
                ws.onerror = (ev) => {
                    log("ERROR (check console)");
                    console.error(ev);
                };
            };

            $("disconnect").onclick = () => {
                if (ws) ws.close();
            };

            $("send").onclick = () => {
                const m = $("msg").value;
                if (!ws || ws.readyState !== WebSocket.OPEN) {
                    log("Not connected");
                    return;
                }
                ws.send(m);
                log("SENT: " + m);
                $("msg").value = "";
            };
        </script>
    </body>
</html>
